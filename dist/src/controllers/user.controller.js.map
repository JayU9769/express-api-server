{"version":3,"sources":["../../../src/controllers/user.controller.ts"],"sourcesContent":["import { NextFunction, Request, Response } from 'express';\nimport { Container } from 'typedi';\nimport { UserService } from '@/services/user.service';\nimport { IDataTable, IFindAllPaginateOptions } from '@/interfaces/datatable.interface';\nimport { IUpdateAction, TSortType } from '@/interfaces/global.interface';\nimport { User } from '@prisma/client';\nimport { HttpException } from '@/exceptions/HttpException';\n\n/**\n * Controller handling user-related HTTP requests.\n */\nexport class UserController {\n  public user = Container.get(UserService);\n\n  /**\n   * Retrieves a paginated list of users based on query parameters.\n   * Supports pagination, filtering, sorting, and search.\n   * @method get\n   * @param req Express request object\n   * @param res Express response object\n   * @param next Express next function for error handling\n   */\n  public getUsers = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      // Destructure query parameters with default values\n      const { pageNumber = 0, perPage = 10, sort = 'createdAt', order = 'ASC', ...filters } = req.query;\n\n      // Prepare options for pagination and filtering\n      const options: IFindAllPaginateOptions = {\n        pageNumber: Number(pageNumber) + 1,\n        perPage: Number(perPage),\n        filters: filters,\n        q: req.query.q as string,\n        ignoreGlobal: (req.query.ignoreGlobal as string)?.split(',') || [],\n        sort: String(sort),\n        order: String(order).toUpperCase() as TSortType,\n      };\n\n      // Fetch paginated user data\n      const findAllUsersData: IDataTable<User> = await this.user.findAllPaginate(options);\n      // Respond with the fetched data\n      res.status(200).json({ data: findAllUsersData, message: 'findAll' });\n    } catch (error) {\n      // Pass any errors to the next error handling middleware\n      next(error);\n    }\n  };\n\n  /**\n   * Retrieves a single user by their ID.\n   * @method get\n   * @param req Express request object with user ID in params\n   * @param res Express response object\n   * @param next Express next function for error handling\n   */\n  public getUserById = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const userId: string = req.params.id;\n      // Find user by ID\n      const findOneUserData: User = await this.user.findById(userId);\n\n      // Respond with the fetched user data\n      res.status(200).json({ data: findOneUserData, message: 'findOne' });\n    } catch (error) {\n      // Pass any errors to the next error handling middleware\n      next(error);\n    }\n  };\n\n  /**\n   * Creates a new user with provided data.\n   * @method post\n   * @param req Express request object with user data in body\n   * @param res Express response object\n   * @param next Express next function for error handling\n   */\n  public createUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const userData: User = req.body;\n      // Create new user\n      const createUserData: User = await this.user.create(userData);\n\n      // Respond with the created user data\n      res.status(201).json({ data: createUserData, message: 'created' });\n    } catch (error) {\n      // Pass any errors to the next error handling middleware\n      next(error);\n    }\n  };\n\n  /**\n   * Updates an existing user with provided data.\n   * @method put\n   * @param req Express request object with user ID in params and user data in body\n   * @param res Express response object\n   * @param next Express next function for error handling\n   */\n  public updateUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const userId: string = req.params.id;\n      const userData: User = req.body;\n      // Update user by ID\n      const updateUserData: User = await this.user.update(userId, userData);\n\n      // Respond with the updated user data\n      res.status(200).json({ data: updateUserData, message: 'updated' });\n    } catch (error) {\n      // Pass any errors to the next error handling middleware\n      next(error);\n    }\n  };\n\n  /**\n   * Deletes a user by their ID.\n   * @method delete\n   * @param req Express request object with user ID in params\n   * @param res Express response object\n   * @param next Express next function for error handling\n   */\n  public deleteUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const userIds: string[] = req.body.ids;\n      // Delete user by ID\n      await this.user.delete(userIds);\n\n      // Respond with success message\n      res.status(200).json({ message: 'deleted' });\n    } catch (error) {\n      // Pass any errors to the next error handling middleware\n      next(error);\n    }\n  };\n\n  /**\n   * Single action a users by their ID & Type.\n   * @method post\n   * @param req Express request object with user ID in params\n   * @param res Express response object\n   * @param next Express next function for error handling\n   */\n  public updateAction = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { ids, field }: IUpdateAction = req.body;\n\n      await this.user.updateAction({ ids, field });\n\n      // Respond with success message\n      res.status(200).json({ message: 'Updated Bulk Action' });\n    } catch (error) {\n      // Pass any errors to the next error handling middleware\n      next(error);\n    }\n  };\n\n  public updateAdminPassword = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { newPassword, confirmNewPassword } = req.body;\n\n      const userId: string = req.params.id;\n\n      // Check if newPassword and confirmNewPassword match\n      if (newPassword !== confirmNewPassword) {\n        throw new HttpException(422, 'New password and confirm password do not match');\n      }\n\n      await this.user.updatePasswordWithoutCurrent(userId, newPassword);\n\n      res.status(200).json({ message: 'Password updated successfully' });\n    } catch (error) {\n      next(error); // Pass any errors to the error handling middleware\n    }\n  };\n}\n"],"names":["UserController","user","Container","get","UserService","getUsers","req","res","next","query","pageNumber","perPage","sort","order","filters","options","Number","q","ignoreGlobal","split","String","toUpperCase","findAllUsersData","findAllPaginate","status","json","data","message","error","getUserById","userId","params","id","findOneUserData","findById","createUser","userData","body","createUserData","create","updateUser","updateUserData","update","deleteUser","userIds","ids","delete","updateAction","field","updateAdminPassword","newPassword","confirmNewPassword","HttpException","updatePasswordWithoutCurrent"],"mappings":"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"}