{"version":3,"sources":["../../../src/middlewares/checkPermission.middleware.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\nimport { IAuthUser } from '@/interfaces/global.interface';\nimport { HttpException } from '@/exceptions/HttpException';\n\n/**\n * Middleware to check if the user has the required permission.\n *\n * @param {string} requiredPermission - The name of the permission to check.\n * @returns {Function} - Express middleware function.\n */\nconst checkPermission = (requiredPermission: string) => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const user = req.user as IAuthUser;\n\n    // Check if the user is authenticated and has permissions\n    if (!user) {\n      // User not authenticated\n      return next(new HttpException(401, 'User not authenticated.'));\n    }\n\n    if (!user.permissions || !Array.isArray(user.permissions)) {\n      // User has no permissions or permissions are not properly formatted\n      return next(new HttpException(403, 'Access denied. No permissions found.'));\n    }\n\n    // Check if the required permission exists in the user's permissions\n    const userPermissions = user.permissions;\n\n    if (userPermissions.includes(requiredPermission)) {\n      // Permission exists, proceed to the next middleware or route handler\n      return next();\n    }\n\n    // Permission not found, deny access\n    return next(new HttpException(403, `Access denied. You do not have the required permission: ${requiredPermission}`));\n  };\n};\n\nexport default checkPermission;\n"],"names":["checkPermission","requiredPermission","req","res","next","user","HttpException","permissions","Array","isArray","userPermissions","includes"],"mappings":";;;;+BAsCA;;;eAAA;;;+BApC8B;AAQ9B,MAAMA,kBAAkB,CAACC;IACvB,OAAO,CAACC,KAAcC,KAAeC;QACnC,MAAMC,OAAOH,IAAIG,IAAI;QAGrB,IAAI,CAACA,MAAM;YAET,OAAOD,KAAK,IAAIE,4BAAa,CAAC,KAAK;QACrC;QAEA,IAAI,CAACD,KAAKE,WAAW,IAAI,CAACC,MAAMC,OAAO,CAACJ,KAAKE,WAAW,GAAG;YAEzD,OAAOH,KAAK,IAAIE,4BAAa,CAAC,KAAK;QACrC;QAGA,MAAMI,kBAAkBL,KAAKE,WAAW;QAExC,IAAIG,gBAAgBC,QAAQ,CAACV,qBAAqB;YAEhD,OAAOG;QACT;QAGA,OAAOA,KAAK,IAAIE,4BAAa,CAAC,KAAK,CAAC,wDAAwD,EAAEL,mBAAmB,CAAC;IACpH;AACF;MAEA,WAAeD"}